<?php
use Sulu\Component\Content\Property;
use Sulu\Component\Content\Block\BlockProperty;
use Sulu\Component\Content\Block\BlockPropertyType;
use Sulu\Component\Content\PropertyTag;

/**
 * {{ cache_class }}
 *
 * DO NOT EDIT
 * This file is autogenerated by the Sulu Content component
 */
class {{ cache_class }} extends {{ base_class }}
{
    public function __construct()
    {
        parent::__construct('{{ content.key }}', '{{ content.view }}', '{{ content.controller }}', '{{ content.cacheLifetime }}');

{% for property in content.properties %}
{{ _self.buildProperty(property, '$this', 1) }}
{% endfor %}
    }
}

{% macro buildProperty(property, parent, layer) %}
{% set child = '$prop'~layer %}
{% if property.type == 'block' %}
        {{ child }} = {{ _self.blockPropertyConstructor(property) }}
        {{ parent }}->addChild({{ child }});
{% for key, properties in property.properties %}
{{ _self.buildTypes(key, properties, child, layer, loop.index) }}
{% endfor %}
{% else %}
        {{ child }} = {{ _self.propertyConstructor(property) }}
        {{ parent }}->addChild({{ child }});
{% endif %}
{% endmacro %}

{% macro buildTypes(name, properties, parent, layer, type) %}
{% set typeVar = '$type'~layer~type %}
        {{ typeVar }} = new BlockPropertyType('{{ name }}');
        {{ parent }}->addType({{ typeVar }});
{% for childProperty in properties %}
{{ _self.buildProperty(childProperty, typeVar, layer+1) }}
{% endfor %}
{% endmacro %}

{% macro propertyConstructor(property) %}
new Property(
            '{{ property.name }}',
            '{{ property.title }}',
            '{{ property.type }}',
            {{ property.mandatory is defined and property.mandatory ? 'true' : 'false' }},
            {{ property.multilingual is defined ? (property.multilingual? 'true':'false') : 'true' }},
            {{ property.maxOccurs is defined ? property.maxOccurs : 1 }},
            {{ property.minOccurs is defined ? property.minOccurs : 1 }},
            array(
{% for param in property.params %}
                '{{ param.name }}' => '{{ param.value }}',
{% endfor %}
            ),
            array(
{% for tag in property.tags %}
                '{{ tag.name }}' => new PropertyTag('{{ tag.name }}', {{ tag.priority is defined and tag.priority ? tag.priority : '1' }}),
{% endfor %}
            )
        );{% endmacro %}

{% macro blockPropertyConstructor(property) %}
new BlockProperty(
            '{{ property.name }}',
            '{{ property.title }}',
            {{ property.mandatory is defined and property.mandatory ? 'true' : 'false' }},
            {{ property.multilingual is defined ? (property.multilingual? 'true':'false') : 'true' }},
            {{ property.maxOccurs is defined ? property.maxOccurs : 1 }},
            {{ property.minOccurs is defined ? property.minOccurs : 1 }},
            array(
{% for param in property.params %}
                '{{ param.name }}' => '{{ param.value }}',
{% endfor %}
            ),
            array(
{% for tag in property.tags %}
                '{{ tag.name }}' => new PropertyTag('{{ tag.name }}', {{ tag.priority is defined and tag.priority ? tag.priority : '1' }}),
{% endfor %}
            )
        );{% endmacro %}
