define(function(){"use strict";var a={copyLocales:function(b){var c=['<div class="copy-locales-overlay-content">',"   <label>",this.sandbox.translate("content.contents.settings.copy-locales.copy-from"),"   </label>",'   <div class="grid m-top-10">','       <div class="grid-row">','       <div id="copy-locales-select" class="grid-col-6"/>',"   </div>","</div>",'<h2 class="divider m-top-20">',this.sandbox.translate("content.contents.settings.copy-locales.target"),"</h2>",'<p class="info">',"   * ",this.sandbox.translate("content.contents.settings.copy-locales.info"),"</p>",'<div class="copy-locales-to-container m-bottom-20 grid">'],d=0;return this.sandbox.util.foreach(this.localizations,function(e){d%2===0&&c.push((d>0?"</div>":"")+'<div class="grid-row">'),c.push(a.copyLocalesCheckbox.call(this,e.title,b)),d++}.bind(this)),c.push("</div>"),c.push("</div>"),c.join("")},copyLocalesCheckbox:function(a){var b,c=[];for(var d in this.data.concreteLanguages)this.data.concreteLanguages.hasOwnProperty(d)&&c.push(this.data.concreteLanguages[d]);return b=a===this.options.language&&c.indexOf(a)>=0,['<div class="grid-col-3">','   <div class="custom-checkbox">','       <input type="checkbox"','              id="copy-locales-to-',a,'"','              name="copy-locales-to" class="form-element" value="',a,'"',b?' disabled="disabled"':"","/>",'       <span class="icon"></span>',"   </div>",'   <label for="copy-locales-to-',a,'" class="',b?"disabled":"",'">',a,c.indexOf(a)<0?" *":"","   </label>","</div>"].join("")}},b=function(a,b,c,d,e){var f=this.getCopyLocaleUrl(a,b,c.join(","));this.sandbox.util.save(f,"POST",{}).then(function(a){d&&"function"==typeof d&&d(a)}.bind(this)).fail(function(a,b,c){e&&"function"==typeof e&&e(c)}.bind(this))};return{copyLocale:function(a,c,d,e,f){b.call(this,a,c,d,e,f)},startCopyLocalesOverlay:function(){var c=this.sandbox.data.deferred(),d=this.sandbox.dom.createElement('<div class="overlay-container"/>'),e=[],f=this.sandbox.translate("content.contents.settings.copy-locales.current-language"),g=function(a){var b="copy-locales-to-"+a;this.sandbox.dom.prop("#"+b,"disabled",""),this.sandbox.dom.removeClass('label[for="'+b+'"]',"disabled")}.bind(this),h=function(a){var b="copy-locales-to-"+a;this.sandbox.dom.prop("#"+b,"disabled","disabled"),this.sandbox.dom.addClass('label[for="'+b+'"]',"disabled")}.bind(this);return this.sandbox.dom.append(this.$el,d),this.sandbox.util.foreach(this.data.concreteLanguages,function(a){e.push({id:a,name:a+(a===this.options.language?" ("+f+")":"")})}.bind(this)),this.sandbox.on("husky.select.copy-locale-to.deselected.item",g),this.sandbox.on("husky.select.copy-locale-to.selected.item",h),this.sandbox.start([{name:"overlay@husky",options:{openOnStart:!0,removeOnClose:!0,el:d,container:this.$el,instanceName:"copy-locales",skin:"wide",slides:[{title:this.sandbox.translate("content.contents.settings.copy-locales.title"),data:a.copyLocales.call(this,this.data),buttons:[{type:"cancel",align:"right"},{type:"ok",text:this.sandbox.translate("content.contents.settings.copy-locales.ok"),align:"left"}],okCallback:function(){var a=this.sandbox.dom.data("#copy-locales-select","selection"),d=this.sandbox.dom.find('.copy-locales-to-container input:checked:not(input[disabled="disabled"])'),e=[];return this.sandbox.util.foreach(d,function(a){e.push(this.sandbox.dom.val(a))}.bind(this)),a&&0!==a.length&&0!==e.length?(this.sandbox.off("husky.select.copy-locale-to.deselected.item",g),this.sandbox.off("husky.select.copy-locale-to.selected.item",h),b.call(this,this.data.id,a[0],e),void c.resolve()):!1}.bind(this)}]}}]),this.sandbox.start([{name:"select@husky",options:{el:"#copy-locales-select",instanceName:"copy-locale-to",defaultLabel:this.sandbox.translate("content.contents.settings.copy-locales.default-label"),preSelectedElements:[this.options.language],data:e}}]),c.promise()}}});