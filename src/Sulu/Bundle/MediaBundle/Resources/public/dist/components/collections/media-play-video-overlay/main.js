define(["services/sulumedia/media-manager"],function(a){"use strict";var b="sulu.media-play-video.",c={instanceName:""},d={loadingClass:"loading",loaderClass:"media-play-video-loader",playVideoId:"media-play-video-id"},e={video:function(a){return['<div class="media-play-video-container">','   <video id="',d.playVideoId,'" controls>','       <source src="',a,'" />',"   </video>","</div>"].join("")}},f=function(){return h.call(this,"closed")},g=function(){return h.call(this,"initialized")},h=function(a){return b+(this.options.instanceName?this.options.instanceName+".":"")+a};return{initialize:function(){if(this.options=this.sandbox.util.extend(!0,{},c,this.options),!this.options.videoId)throw new Error("videoId not defined");this.startLoadingOverlay(),this.loadVideo(this.options.videoId,this.options.locale).then(function(a){this.startVideoOverlay(a)}.bind(this)),this.sandbox.emit(g.call(this))},startLoadingOverlay:function(){var a=this.sandbox.dom.createElement('<div class="'+d.loadingClass+'"/>'),b=this.sandbox.dom.createElement('<div class="'+d.loaderClass+'" />');this.sandbox.dom.append(this.$el,a),this.sandbox.once("husky.overlay.media-play-video.loading.opened",function(){this.sandbox.start([{name:"loader@husky",options:{el:b,size:"100px",color:"#cccccc"}}])}.bind(this)),this.sandbox.start([{name:"overlay@husky",options:{el:a,skin:"wide",openOnStart:!0,removeOnClose:!0,instanceName:"media-play-video.loading",closeIcon:"",slides:[{title:this.sandbox.translate("sulu.media.play-video.loading"),data:b,okInactive:!0,buttons:[{type:"cancel",inactive:!1,text:"public.cancel",align:"left"}]}]}}])},loadVideo:function(b,c){var d,e=$.Deferred();return d=a.loadOrNew(b,c),d.then(function(a){e.resolve(a)}.bind(this)),e},startVideoOverlay:function(a){var b,c,f=a.url+"&inline=1";b=this.sandbox.dom.createElement('<div class="'+d.singleEditClass+'" id="media-form"/>'),c=this.sandbox.dom.createElement(e.video(f)),this.sandbox.dom.append(this.$el,b),this.bindVideoOverlayEvents(),this.sandbox.start([{name:"overlay@husky",options:{el:b,skin:"wide",openOnStart:!0,removeOnClose:!0,instanceName:"media-play-video",propagateEvents:!1,slides:[{title:a.title,data:c,okInactive:!0,buttons:[{type:"cancel",inactive:!1,text:"public.cancel",align:"left"}],cancelCallback:function(){this.sandbox.stop()}.bind(this)}]}}])},bindVideoOverlayEvents:function(){this.sandbox.once("husky.overlay.media-play-video.opened",function(){var a=document.getElementById(d.playVideoId);a.autoplay=!0}.bind(this)),this.sandbox.once("husky.overlay.media-play-video.initialized",function(){this.sandbox.emit("husky.overlay.media-play-video.loading.close")}.bind(this))},destroy:function(){this.sandbox.emit(f.call(this))}}});