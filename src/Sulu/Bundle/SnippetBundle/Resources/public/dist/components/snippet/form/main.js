define(["sulusnippet/components/snippet/main","sulusnippet/model/snippet","app-config"],function(a,b,c){"use strict";var d=1,e=2,f={view:!0,layout:{sidebar:!1,navigation:{collapsed:!1},content:{width:"fixed",shrinkable:!1}},header:function(){return{breadcrumb:this.breadcrumb,tabs:{url:"/admin/snippet/navigation/snippet"},toolbar:{parentTemplate:"default",languageChanger:{url:"/admin/api/languages",preSelected:this.options.language},template:[{id:"state",group:"left",position:100,type:"select",itemsOption:{markable:!0},items:[{id:e,title:this.sandbox.translate("toolbar.state-publish"),icon:"husky-publish",callback:function(){this.state=e,this.sandbox.emit("sulu.dropdown.state.item-clicked",e)}.bind(this)},{id:d,title:this.sandbox.translate("toolbar.state-test"),icon:"husky-test",callback:function(){this.state=d,this.sandbox.emit("sulu.dropdown.state.item-clicked",d)}.bind(this)}]},{id:"template",icon:"pencil",iconSize:"large",group:"left",position:10,type:"select",title:"",hidden:!1,itemsOption:{url:"/admin/api/snippet/types",titleAttribute:"title",idAttribute:"template",translate:!1,markable:!0,callback:function(a){this.template=a.template,this.sandbox.emit("sulu.dropdown.template.item-clicked",a)}.bind(this)}}]}}},initialize:function(){this.config=c.getSection("sulu-snippet"),this.defaultType=this.config.defaultType,this.template=this.defaultType,this.state=d,this.type=this.options.id?"edit":"add",this.headerDef=this.sandbox.data.deferred(),this.dataDef=this.sandbox.data.deferred(),this.bindModelEvents(),this.bindCustomEvents(),this.loadData()},bindCustomEvents:function(){this.sandbox.on("sulu.header.back",function(){this.sandbox.emit("sulu.snippets.snippet.list")}.bind(this)),this.sandbox.on("husky.toolbar.header.initialized",function(){this.headerDef.resolve()}.bind(this)),this.sandbox.on("sulu.snippets.snippet.get-data",function(a){this.dataDef.then(function(){a(this.data)}.bind(this))}.bind(this)),this.sandbox.on("sulu.snippets.snippet.set-header-bar",function(a){this.setHeaderBar(a)}.bind(this)),this.sandbox.on("sulu.snippets.snippet.set-state",function(a){this.setState(a)}.bind(this)),this.sandbox.on("sulu.snippets.snippet.saved",function(a){this.data=a,this.setHeaderBar(!0),this.setTitle(this.data.title),this.sandbox.emit("sulu.labels.success.show","labels.success.content-save-desc","labels.success")},this),this.sandbox.on("sulu.snippets.snippet.save-error",function(){this.sandbox.emit("sulu.labels.error.show","labels.error.content-save-desc","labels.error"),this.setHeaderBar(!1)},this),this.sandbox.on("sulu.header.toolbar.delete",function(){this.sandbox.emit("sulu.snippets.snippet.delete",this.data.id)},this)},setState:function(a){a.nodeState&&(this.state=a.nodeState,""!==this.state&&void 0!==this.state&&null!==this.state&&this.sandbox.emit("sulu.header.toolbar.item.change","state",a.nodeState))},setHeaderBar:function(a){if(a!==this.saved){var b=this.data&&this.data.id?"edit":"add";this.sandbox.emit("sulu.header.toolbar.state.change",b,a,this.highlightSaveButton),this.sandbox.emit("sulu.preview.state.change",a)}this.saved=a,this.saved&&(this.contentChanged=!1)},loadData:function(){this.model||(this.model=new b({id:this.options.id})),void 0!==this.options.id?this.model.fullFetch(this.options.language,{success:function(a){this.render(a.toJSON()),this.dataDef.resolve()}.bind(this)}):(this.render(this.model.toJSON()),this.dataDef.resolve())},render:function(a){this.data=a,this.headerDef.then(function(){this.setTitle(a.title)}.bind(this))},setTitle:function(a){var b=[{title:"navigation.snippets"},{title:"snippets.snippet.title"}];this.options.id&&""!==a?(this.sandbox.emit("sulu.header.set-title",this.sandbox.util.cropMiddle(a,40)),b.push({title:a}),this.sandbox.emit("sulu.header.set-breadcrumb",b)):(this.sandbox.emit("sulu.header.set-title",this.sandbox.translate("snippets.snippet.title")),this.sandbox.emit("sulu.header.set-breadcrumb",b))}};return f.__proto__=a,f});