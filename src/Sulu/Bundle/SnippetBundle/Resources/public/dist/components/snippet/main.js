define(["sulusnippet/model/snippet"],function(a){"use strict";var b="contentLanguage";return{bindModelEvents:function(){this.sandbox.on("sulu.snippets.snippet.delete",function(){this.del()},this),this.sandbox.on("sulu.snippets.snippet.save",function(a){this.save(a)},this),this.sandbox.on("sulu.snippets.snippet.load",function(a,b){this.load(a,b)},this),this.sandbox.on("sulu.snippets.snippet.new",function(a){this.add(a)},this),this.sandbox.on("sulu.snippets.snippet.delete",function(a){this.delSnippets(a)},this),this.sandbox.on("sulu.snippets.snippet.list",function(){this.sandbox.emit("sulu.router.navigate","snippet/snippets")},this),this.sandbox.on("sulu.header.toolbar.language-changed",function(a){this.sandbox.sulu.saveUserSetting(b,a.localization);var c=this.content.toJSON();"index"===this.options.id&&(c.id=this.options.id),"edit"===this.type?this.sandbox.emit("sulu.snippets.snippet.load",c.id,a.localization):"add"===this.type?this.sandbox.emit("sulu.snippets.snippet.new",a.localization):this.sandbox.emit("sulu.snippets.snippet.list")},this)},del:function(){this.confirmDeleteDialog(function(a){a&&(this.sandbox.emit("sulu.header.toolbar.item.loading","options-button"),this.model.destroy({success:function(){this.sandbox.emit("sulu.router.navigate","snippet/snippets")}.bind(this)}))}.bind(this))},save:function(a){this.sandbox.emit("sulu.header.toolbar.item.loading","save-button"),a.template=this.template,this.model.set(a),this.model.fullSave(this.template,this.options.language,this.state,{success:function(b){var c=b.toJSON();a.id?this.sandbox.emit("sulu.snippets.snippet.saved",c):this.sandbox.emit("sulu.router.navigate","snippet/snippets/"+this.options.language+"/edit:"+c.id)}.bind(this),error:function(){this.sandbox.logger.log("error while saving profile")}.bind(this)})},load:function(a,b){b||(b=this.options.language),this.sandbox.emit("sulu.router.navigate","snippet/snippets/"+b+"/edit:"+a)},add:function(a){a||(a=this.options.language),this.sandbox.emit("sulu.router.navigate","snippet/snippets/"+a+"/add")},delSnippets:function(b){return b.length<1?void this.sandbox.emit("sulu.dialog.error.show","No snippets selected for Deletion"):void this.confirmDeleteDialog(function(c){c&&b.forEach(function(b){var c=new a({id:b});c.destroy({success:function(){this.sandbox.emit("husky.datagrid.record.remove",b)}.bind(this)})}.bind(this))}.bind(this))},confirmDeleteDialog:function(a){if(a&&"function"!=typeof a)throw"callback is not a function";this.sandbox.emit("sulu.overlay.show-warning","sulu.overlay.be-careful","sulu.overlay.delete-desc",a.bind(this,!1),a.bind(this,!0))}}});