define(["services/husky/util","services/husky/mediator","sulucontact/models/contact","sulucontact/models/title","sulucontact/models/position","sulucategory/model/category","sulumedia/model/media"],function(a,b,c,d,e,f){"use strict";function g(){}var h=null,i=function(b,c){var d=[],e=$.Deferred();return b.length?(a.each(b,function(b,e){d.push(a.ajax({url:"/admin/api/contacts/"+c+"/medias/"+e,data:{mediaId:e},type:"DELETE"}))}.bind(this)),$.when.apply(null,d).then(function(){e.resolve()}.bind(this))):e.resolve(),e},j=function(b,c){var d=[],e=$.Deferred();return b.length?(a.each(b,function(b,e){d.push(a.ajax({url:"/admin/api/contacts/"+c+"/medias",data:{mediaId:e},type:"POST"}))}.bind(this)),$.when.apply(null,d).then(function(){e.resolve()}.bind(this))):e.resolve(),e};return g.prototype={loadOrNew:function(a){var b,d=$.Deferred();return a?(b=c.findOrCreate({id:a}),b.fetch({success:function(a){d.resolve(a.toJSON())}.bind(this),error:function(){d.fail()}.bind(this)})):(b=new c,d.resolve(b.toJSON())),d},"delete":function(a){var b=$.Deferred(),d=c.findOrCreate({id:a});return d.destroy({success:function(){b.resolve()}.bind(this),error:function(){b.fail()}.bind(this)}),b},save:function(b){var d=$.Deferred(),e=c.findOrCreate({id:b.id});return e.set(b),e.get("categories").reset(),a.foreach(b.categories,function(a){var b=f.findOrCreate({id:a});e.get("categories").add(b)}.bind(this)),e.save(null,{success:function(a){d.resolve(a.toJSON())}.bind(this),error:function(){d.fail()}.bind(this)}),d},saveDocuments:function(a,b,c){var d=$.Deferred(),e=j.call(this,b,a),f=i.call(this,c,a);return $.when(f,e).then(function(){d.resolve()}.bind(this)),d}},g.getInstance=function(){return null==h&&(h=new g),h},g.getInstance()});