define(["config"],function(a){"use strict";var b={unselectOnBackgroundClick:!0},c={containerClass:"contact-grid",selectedClass:"selected",suluUserClass:"sulu-user",actionNavigatorClass:"action-navigator",itemHeadClass:"item-head",itemInfoClass:"item-info",avatarThumbnailFormat:"100x100"},d={item:['<div class="contact-item">','   <div class="'+c.itemHeadClass+'">','       <div class="head-container">','           <div class="head-image '+c.actionNavigatorClass+'" style="background-image: url(\'<%= avatar %>\')"></div>','           <div class="head-name '+c.actionNavigatorClass+'"><%= name %></div>',"       </div>",'       <div class="head-checkbox custom-checkbox"><input type="checkbox"><span class="icon"></span></div>','       <div class="head-sulubox"><div class="sulubox-signet"></div></div>',"   </div>",'   <div class="'+[c.itemInfoClass,c.actionNavigatorClass].join(" ")+'"></div>',"</div>"].join(""),infoRow:['       <div class="info-row">','           <span class="<%= icon %> info-icon"></span>','           <span class="info-text"><%= text %></span>',"       </div>"].join("")},e=function(a,b){var c=[];return a.forEach(function(a){a&&c.push(a)}),c.join(b)};return{initialize:function(a,c){this.datagrid=a,this.sandbox=this.datagrid.sandbox,this.options=this.sandbox.util.extend(!0,{},b,c),this.setVariables()},setVariables:function(){this.rendered=!1,this.data=null,this.$el=null,this.$items={}},render:function(a,b){this.data=a,this.$el=this.sandbox.dom.createElement('<div class="'+c.containerClass+'"/>'),this.sandbox.dom.append(b,this.$el),this.bindGeneralDomEvents(),this.renderItems(this.data.embedded),this.rendered=!0},bindGeneralDomEvents:function(){this.options.unselectOnBackgroundClick&&this.sandbox.dom.on(".body","click.contact.list",function(){this.unselectAllItems()}.bind(this))},renderItems:function(b){this.sandbox.util.foreach(b,function(b){var d,f,g,h,i,j;d=b.id,f=b.avatar?b.avatar[c.avatarThumbnailFormat]:a.get("sulucontact.contacts.default.avatar").url,h=Math.random()<.5,j=b.mainEmail,g=e([b.firstName,b.lastName]," "),i=e([b.city,b.countryCode],", "),this.renderItem(d,f,g,h,i,j)}.bind(this))},renderItem:function(a,b,e,f,g,h){this.$items[a]=this.sandbox.dom.createElement(this.sandbox.util.template(d.item)({name:this.sandbox.util.cropTail(String(e),32),isSuluUser:f,avatar:b})),f&&this.sandbox.dom.addClass(this.$items[a],c.suluUserClass),g&&this.addInfoRowToItem(this.$items[a],"fa-map-marker",g),h&&this.addInfoRowToItem(this.$items[a],"fa-envelope",h),this.datagrid.itemIsSelected.call(this.datagrid,a)&&this.selectItem(a),this.sandbox.dom.append(this.$el,this.$items[a]),this.bindItemDomEvents(a)},addInfoRowToItem:function(a,b,e){this.sandbox.dom.append(this.sandbox.dom.find("."+c.itemInfoClass,a),this.sandbox.dom.createElement(this.sandbox.util.template(d.infoRow)({icon:b,text:this.sandbox.util.cropMiddle(String(e),18)})))},destroy:function(){this.sandbox.dom.off(".body","click.contact.list"),this.sandbox.dom.remove(this.$el)},bindItemDomEvents:function(a){this.sandbox.dom.on(this.$items[a],"click",function(b){this.sandbox.dom.stopPropagation(b),this.datagrid.itemAction.call(this.datagrid,a)}.bind(this),"."+c.actionNavigatorClass),this.sandbox.dom.on(this.$items[a],"click",function(b){this.sandbox.dom.stopPropagation(b),this.toggleItemSelected(a)}.bind(this),"."+c.itemHeadClass)},toggleItemSelected:function(a){this.datagrid.itemIsSelected.call(this.datagrid,a)===!0?this.unselectItem(a):this.selectItem(a)},selectItem:function(a){this.sandbox.dom.addClass(this.$items[a],c.selectedClass),this.sandbox.dom.is(this.sandbox.dom.find('input[type="checkbox"]',this.$items[a]),":checked")||this.sandbox.dom.prop(this.sandbox.dom.find('input[type="checkbox"]',this.$items[a]),"checked",!0),this.datagrid.setItemSelected.call(this.datagrid,a)},unselectItem:function(a){this.sandbox.dom.removeClass(this.$items[a],c.selectedClass),this.sandbox.dom.is(this.sandbox.dom.find('input[type="checkbox"]',this.$items[a]),":checked")&&this.sandbox.dom.prop(this.sandbox.dom.find('input[type="checkbox"]',this.$items[a]),"checked",!1),this.datagrid.setItemUnselected.call(this.datagrid,a)},addRecord:function(a){this.renderItems([a])},removeRecord:function(a){return this.$items[a]?(this.sandbox.dom.remove(this.$items[a]),this.datagrid.removeRecord.call(this.datagrid,a),!0):!1},unselectAllItems:function(){this.sandbox.util.each(this.$items,function(a){this.unselectItem(Number(a))}.bind(this))}}});